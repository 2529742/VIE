<!DOCTYPE html>  <html> <head>   <title>vie-latest.debug.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="vie-latest.debug.html">                 vie-latest.debug.js               </a>                                           <a class="source" href="node_proxy.html">                 node_proxy.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               vie-latest.debug.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Handle dependencies</h3>

<p>VIE tries to load its dependencies automatically. 
Please note that this autoloading functionality only works on the server.
On browser Backbone needs to be included manually.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Require <a href="http://documentcloud.github.com/underscore/">underscore.js</a> 
using CommonJS require if it isn't yet loaded.</p>

<p>On node.js underscore.js can be installed via:</p>

<pre><code>npm install underscore
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_</span><span class="o">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">).</span><span class="nx">_</span><span class="o">;</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s1">&#39;VIE requires underscore.js to be available&#39;</span><span class="o">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Require <a href="http://documentcloud.github.com/backbone/">Backbone.js</a> 
using CommonJS require if it isn't yet loaded.</p>

<p>On node.js Backbone.js can be installed via:</p>

<pre><code>npm install backbone
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Backbone</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s1">&#39;VIE requires Backbone.js to be available&#39;</span><span class="o">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Require <a href="http://jquery.com/">jQuery</a> using CommonJS require if it 
isn't yet loaded.</p>

<p>On node.js jQuery can be installed via:</p>

<pre><code>npm install jquery
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">jQuery</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">jQuery</span><span class="o">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">require</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="nx">jQuery</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">);</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s1">&#39;VIE requires jQuery to be available&#39;</span><span class="o">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">VIE</span><span class="o">;</span>
<span class="nx">VIE</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="o">?</span> <span class="nx">config</span> <span class="o">:</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">services</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">entities</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Collection</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">Entity</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">entities</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">entities</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">Entity</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">entityCollection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Collection</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">Entity</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">defaultProxyUrl</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultProxyUrl</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultProxyUrl</span> <span class="o">:</span> <span class="s2">&quot;../utils/proxy/proxy.php&quot;</span><span class="o">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">Namespaces</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Namespaces</span><span class="p">(</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultNamespace</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultNamespace</span> <span class="o">:</span> <span class="s2">&quot;http://ontology.vie.js/&quot;</span>
    <span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">Attributes</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">types</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Types</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;Thing&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">classic</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Load Classic API as well</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">RDFa</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">ClassicRDFa</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">RDFaEntities</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">ClassicRDFaEntities</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">EntityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">ClassicEntityManager</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">cleanup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">use</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">name</span><span class="o">;</span>
  <span class="p">}</span>
  <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="nx">service</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="o">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">init</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">service</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">service</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">service</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s2">&quot;Undefined service &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="o">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getServicesArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">i</span><span class="p">){</span><span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">service</span><span class="p">);});</span>
  <span class="k">return</span> <span class="nx">res</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Declaring the ..able classes
Loadable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Loadable</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Savable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Savable</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Removable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Removable</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Analyzable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">analyze</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Analyzable</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Findable</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Findable</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>


<span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">VIE</span> <span class="o">=</span> <span class="nx">VIE</span><span class="o">;</span>
<span class="p">}</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>takes a list of services or just one</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">using</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">services</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">services</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">(</span><span class="nx">services</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">){</span>
                <span class="nx">service</span><span class="p">.</span><span class="nx">_using</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">services</span><span class="o">;</span>
            <span class="nx">service</span><span class="p">.</span><span class="nx">_using</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="nx">_using</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">service</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">serviceObj</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">service</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="nx">service</span><span class="p">)</span> <span class="o">:</span> <span class="nx">service</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">serviceObj</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span> <span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">methodName</span> <span class="o">=</span> <span class="nx">methodName</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">services</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">from</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">using</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">to</span> <span class="o">||</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Public deferred-methods</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">resolveWith</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">resolveWith</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">rejectWith</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">rejectWith</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Synonyms</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">success</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">done</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fail</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">fail</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">then</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">then</span><span class="o">;</span> <span class="c">// Takes 2 arguments, successCallbacks, failCallbacks</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">always</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">always</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">using</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">using</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Running the actual method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">execute</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>call service.load</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">able</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">service</span><span class="p">){</span>
            <span class="nx">service</span><span class="p">[</span><span class="nx">able</span><span class="p">.</span><span class="nx">methodName</span><span class="p">](</span><span class="nx">able</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Loadable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span><span class="s2">&quot;load&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Loadable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">();</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Savable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span> <span class="s2">&quot;save&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Savable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">();</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Removable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span> <span class="s2">&quot;remove&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Removable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">();</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Analyzable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span> <span class="s2">&quot;analyze&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Analyzable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">();</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Findable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="o">,</span> <span class="s2">&quot;find&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Findable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Able</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>File:   Util.js <br />
Author: <a href="http://github.com/neogermi/">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Utilities for the day-to-day VIE.js usage</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>extension to jQuery to compare two arrays on equality
found: <a href="http://stackoverflow.com/questions/1773069/using-jquery-to-compare-two-arrays">http://stackoverflow.com/questions/1773069/using-jquery-to-compare-two-arrays</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span><span class="o">,</span>
        <span class="nx">b</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">t</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span> 
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Extension to the JS native Array implementation to remove values from an array.
from: <a href="http://sebastian.germes.in/blog/2011/09/javascripts-missing-array-remove-function/">http://sebastian.germes.in/blog/2011/09/javascripts-missing-array-remove-function/</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">.</span><span class="nx">arguments</span><span class="o">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="k">else</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="p">};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Extension to the JS native Array implementation to remove duplicates from an array.
This actually leaves the original Array untouched and returns a copy with no duplicates.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unduplicate</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unduplicate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">sorted_arr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
	    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
	    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sorted_arr</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">sorted_arr</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">sorted_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">sorted_arr</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	            <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sorted_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
	        <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">return</span> <span class="nx">results</span><span class="o">;</span>
	<span class="p">};</span>
<span class="p">}</span> 


<span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>converts a given URI into a CURIE (or save CURIE), based
on the given VIE.Namespaces object.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">toCurie</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">safe</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">delim</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nx">delim</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
                <span class="k">return</span> <span class="p">((</span><span class="nx">safe</span><span class="p">)</span><span class="o">?</span> <span class="s2">&quot;[&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> 
                        <span class="nx">uri</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pattern</span><span class="o">,</span> <span class="nx">k</span> <span class="o">+</span> <span class="nx">delim</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
                        <span class="p">((</span><span class="nx">safe</span><span class="p">)</span><span class="o">?</span> <span class="s2">&quot;]&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No prefix found for URI &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>checks, whether the given string is a CURIE.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">isCurie</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">something</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">try</span> <span class="p">{</span>
    		 <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">toUri</span> <span class="p">(</span><span class="nx">something</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">);</span>
    		 <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    	<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    		<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    	<span class="p">}</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>converts a given CURIE (or save CURIE) into a URI, based
on the given VIE.Namespaces object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">toUri</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">curie</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">delim</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">curie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">curie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="s2">&quot;\\[{0,1}&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="nx">delim</span><span class="p">);</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">curie</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pattern</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\]{0,1}$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>default:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">curie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">delim</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">base</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="nx">curie</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No prefix found for CURIE &#39;&quot;</span> <span class="o">+</span> <span class="nx">curie</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>checks, whether the given string is a URI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">isUri</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">something</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">something</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">something</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="sr">/^&lt;.+:.+&gt;$/</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_blankNodeSeed</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">%</span> <span class="mi">1000</span><span class="o">,</span>
    
    <span class="nx">blankNodeID</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_blankNodeSeed</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="k">return</span> <span class="s1">&#39;_:bnode&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_blankNodeSeed</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
    <span class="p">}</span>    
    
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Entity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    
    <span class="kd">var</span> <span class="nx">mapAttributeNS</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">attr</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span><span class="p">.</span><span class="nx">isUri</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">||</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>ignore</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">uri</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ns</span><span class="p">.</span><span class="nx">isUri</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
        	<span class="k">if</span> <span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">a</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="nx">attr</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
        	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">a</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">attr</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
        	<span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">a</span><span class="o">;</span>
    <span class="p">};</span>
        
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;@type&#39;</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">val</span><span class="p">).</span><span class="nx">id</span><span class="o">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">val</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]).</span><span class="nx">id</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>provide "Thing" as the default type if none was given</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;Thing&quot;</span><span class="p">).</span><span class="nx">id</span><span class="o">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>the following provides full seamless namespace support
for attributes. It should not matter, if you
query for <code>model.get('name')</code> or <code>model.get('foaf:name')</code>
or even <code>model.get('http://xmlns.com/foaf/0.1/name');</code>
However, if we just overwrite <code>set()</code> and <code>get()</code>, this
raises a lot of side effects, so we need to expand
the attributes before we create the model.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">attrs</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="o">?</span> <span class="nx">attrs</span> <span class="o">:</span> <span class="p">{};</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newKey</span> <span class="o">=</span> <span class="nx">mapAttributeNS</span><span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!==</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="nx">attrs</span><span class="p">[</span><span class="nx">newKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">idAttribute</span><span class="o">:</span> <span class="s1">&#39;@subject&#39;</span><span class="o">,</span>

        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attributes</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toReference</span><span class="p">(</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">]);</span>
            <span class="p">}</span>            
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
                
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">mapAttributeNS</span><span class="p">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">value</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;@type&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">v</span><span class="o">;</span>
                    <span class="p">}</span>
                <span class="p">}</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;@type&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>

        <span class="nx">has</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">mapAttributeNS</span><span class="p">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">has</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">set</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attrs</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> 
                <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">attributes</span><span class="o">;</span>
          
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">newKey</span> <span class="o">=</span> <span class="nx">mapAttributeNS</span><span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!==</span> <span class="nx">newKey</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                    <span class="nx">attrs</span><span class="p">[</span><span class="nx">newKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                   <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> 
                       <span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                       <span class="o">!</span><span class="nx">value</span><span class="p">.</span><span class="nx">isCollection</span><span class="p">)</span> <span class="p">{</span>
                       <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Entity</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
                       <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
                       <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">();</span>
                   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">isCollection</span><span class="p">)</span> <span class="p">{</span>
                       <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                       <span class="nx">value</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="p">{</span>
                           <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
                           <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">());</span>
                       <span class="p">});</span>
                   <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attrs</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">unset</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">mapAttributeNS</span><span class="p">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unset</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attr</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">getSubject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;http://&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;urn:&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toReference</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="o">,</span> <span class="s1">&#39;_:bnode&#39;</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">getSubjectUri</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fromReference</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">());</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">isReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">matcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\&lt;([^\\&gt;]*)\\&gt;$&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">matcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">toReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">uri</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isReference</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">fromReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">uri</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isReference</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">as</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">encoding</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;JSON&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span> <span class="o">===</span> <span class="s2">&quot;JSONLD&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toJSONLD</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">throw</span> <span class="s2">&quot;Unknown encoding &quot;</span> <span class="o">+</span> <span class="nx">encoding</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">toJSONLD</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">instanceLD</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">attributes</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">name</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">entityValue</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;@type&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">entityValue</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">entityValue</span> <span class="o">=</span> <span class="nx">entityValue</span><span class="p">.</span><span class="nx">id</span><span class="o">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Collection</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">entityValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>TODO: Handle collections separately</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">instanceLD</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entityValue</span><span class="o">;</span>
            <span class="p">});</span>
            
            <span class="nx">instanceLD</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">();</span>
            
            <span class="k">return</span> <span class="nx">instanceLD</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">setOrAdd</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arg1</span><span class="o">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">arg1</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>calling entity.setOrAdd("rdfs:type", "example:Musician")</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">entity</span><span class="p">.</span><span class="nx">_setOrAddOne</span><span class="p">(</span><span class="nx">arg1</span><span class="o">,</span> <span class="nx">arg2</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> 
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">arg1</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>calling entity.setOrAdd({"rdfs:type": "example:Musician", ...})</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">_</span><span class="p">(</span><span class="nx">arg1</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="o">,</span> <span class="nx">key</span><span class="p">){</span>
                        <span class="nx">entity</span><span class="p">.</span><span class="nx">_setOrAddOne</span><span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">val</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">_setOrAddOne</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prop</span><span class="o">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>if value is an entity, convert it to string</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="o">?</span> <span class="nx">value</span><span class="p">.</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">value</span><span class="o">;</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>No value yet, use the set method</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">val</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="p">[</span><span class="nx">val</span><span class="p">];</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Make sure not to set the same value twice</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">contains</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">v</span> <span class="o">&lt;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">contains</span> <span class="o">|=</span> <span class="nx">val</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">==</span> <span class="nx">value</span><span class="o">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">contains</span> <span class="o">|=</span> <span class="nx">val</span><span class="p">[</span><span class="nx">v</span><span class="p">].</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">value</span><span class="o">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">contains</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">val</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
                    <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="o">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">hasType</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasPropertyValue</span><span class="p">(</span><span class="s2">&quot;@type&quot;</span><span class="o">,</span> <span class="nx">type</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">hasPropertyValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="o">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">property</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">value</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">t</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">t</span> <span class="o">===</span> <span class="nx">value</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">isof</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;@type&#39;</span><span class="p">);</span>
            
            <span class="nx">types</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">types</span><span class="p">))</span><span class="o">?</span> <span class="nx">types</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">types</span> <span class="p">];</span>
            
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">types</span><span class="p">[</span><span class="nx">t</span><span class="p">])</span> <span class="o">&amp;&amp;</span> 
                    <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">types</span><span class="p">[</span><span class="nx">t</span><span class="p">]).</span><span class="nx">isof</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        
        <span class="nx">isEntity</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
        
        <span class="nx">vie</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>    
<span class="p">};</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">model</span><span class="o">:</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Entity</span><span class="o">,</span>
    
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">)</span><span class="o">?</span> <span class="nx">id</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">()</span> <span class="o">:</span> <span class="nx">id</span><span class="o">;</span>        
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;_:&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;bnode&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>bnode!</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;_:bnode&quot;</span><span class="o">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byCid</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toReference</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">addOrUpdate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">model</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">entities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">collection</span><span class="p">.</span><span class="nx">addOrUpdate</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">entities</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">model</span><span class="p">.</span><span class="nx">isEntity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">model</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">existing</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">existing</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">existing</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">model</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">isReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">matcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\&lt;([^\\&gt;]*)\\&gt;$&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">matcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
        
    <span class="nx">toReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isReference</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
        
    <span class="nx">fromReference</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isReference</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">uri</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">isCollection</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>File:   Type.js <br />
Author: <a href="http://github.com/neogermi/">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Adding capability of handling type/class structure and inheritance to VIE. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="s2">&quot;ERROR: VIE.Type is already defined. Please check your installation!&quot;</span><span class="o">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Types</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="s2">&quot;ERROR: VIE.Types is already defined. Please check your installation!&quot;</span><span class="o">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>The constructor of a VIE.Type. 
Usage: <code>var personType = new vie.Type("Person", []).inherit("Thing");</code>
This creates a type person in the base namespace that has no attributes
but inherits from the type "Thing". </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Type</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The type constructor needs an &#39;id&#39; of type string! E.g., &#39;Person&#39;&quot;</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">isUri</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">?</span> <span class="nx">id</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">uri</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>checks whether such a type is already defined. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The type &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; is already defined!&quot;</span><span class="o">;</span>
    <span class="p">}</span>    
    </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>the supertypes (parentclasses) of the current type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">supertypes</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Types</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>the subtypes (childclasses) of the current type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">subtypes</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Types</span><span class="p">();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>the given attributes as a <code>vie.Attributes</code> element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Attributes</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">)</span><span class="o">?</span> <span class="nx">attrs</span> <span class="o">:</span> <span class="p">[]);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>checks whether the current type inherits of the
given type, e.g.,: <code>personType.isof("Thing");</code>
would evaluate to <code>true</code>.
We can either pass a type object or a string that
represents the id of the type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">isof</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">subsumes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;No valid type given&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>checks whether the current type subsumes the
given type, e.g.,: <code>thingType.subsumes("Person");</code>
would evaluate to <code>true</code>.
We can either pass a type object or a string that
represents the id of the type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">subsumes</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">type</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">subtypes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="nx">subtypes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">childObj</span> <span class="o">=</span> <span class="nx">subtypes</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">childObj</span><span class="p">)</span> <span class="p">{</span>
                     <span class="k">if</span> <span class="p">(</span><span class="nx">childObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">type</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">childObj</span><span class="p">.</span><span class="nx">subsumes</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
                         <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                     <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;No valid type given&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>inherit all attributes from the supertype (recursively).
we can either pass a string (id) of the supertype, the
supertype itself or an array of both.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">inherit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">supertype</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">supertype</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">supertype</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">supertype</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">supertype</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">addOrOverwrite</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">supertypes</span><span class="p">.</span><span class="nx">addOrOverwrite</span><span class="p">(</span><span class="nx">supertype</span><span class="p">);</span>
            <span class="k">try</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>only for validation of attribute-inheritance!
if this throws an error (inheriting two attributes
that cannot be combined) we reverse all changes. </p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">supertype</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">supertypes</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">supertype</span><span class="p">);</span>
                <span class="k">throw</span> <span class="nx">e</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">supertype</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">supertype</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">supertype</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Wrong argument in VIE.Type.inherit()&quot;</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>serializes the hierarchy of child types into an
object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">hierarchy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">subtypes</span><span class="o">:</span> <span class="p">[]};</span>
        <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">childObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">c</span><span class="p">]);</span>
            <span class="nx">obj</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">childObj</span><span class="p">.</span><span class="nx">hierarchy</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">obj</span><span class="o">;</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">instance</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    	<span class="nx">attrs</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">)</span><span class="o">?</span> <span class="nx">attrs</span> <span class="o">:</span> <span class="p">{};</span>
    	
    	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
    		<span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span> <span class="p">{</span>
    			<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot create an instance of &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; as the type does not allow an attribute &#39;&quot;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    		<span class="p">}</span>
    	<span class="p">}</span>
    	
    	<span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">;</span>
    	
    	<span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Entity</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>returns the id of the type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">;</span>
    <span class="p">};</span>
    
    
    
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>basically a convenience class that represents a list of <code>VIE.Type</code>s.
var types = new vie.Types();</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Types</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        
    <span class="k">this</span><span class="p">.</span><span class="nx">_types</span> <span class="o">=</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Adds a <code>VIE.Type</code> to the types.
This throws an exception if a type with the given id
already exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Type &#39;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; already registered.&quot;</span><span class="o">;</span>
        <span class="p">}</span> 
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
                <span class="k">return</span> <span class="nx">t</span><span class="o">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span> <span class="p">{</span>
            	<span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">id</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="o">;</span>
                <span class="k">return</span> <span class="nx">id</span><span class="o">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="s2">&quot;Wrong argument to VIE.Types.add()!&quot;</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>This is the same as <code>this.remove(id); this.add(id, attrs);</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">addOrOverwrite</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Retrieve a type by either it's id or by the type itself
(for convenience issues).
Returnes <strong>undefined</strong> if no type has been found.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">lid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">isUri</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">?</span> <span class="nx">id</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">uri</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">lid</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Removes a type of given id from the type. This also
removes all children if their only parent were this
type. Furthermore, this removes the link from the
super- and subtypes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
        
        <span class="kd">var</span> <span class="nx">subtypes</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">subtypes</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="nx">subtypes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">childObj</span> <span class="o">=</span> <span class="nx">subtypes</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">childObj</span><span class="p">.</span><span class="nx">supertypes</span><span class="p">.</span><span class="nx">list</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>recursively remove all children 
that inherit only from this type</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">childObj</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">childObj</span><span class="p">.</span><span class="nx">supertypes</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">t</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>returns an array of all types.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Sorts an array of types in their order, given by the
inheritance. If 'desc' is given and 'true', the sorted
array will be in descendant order.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">sort</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">types</span><span class="o">,</span> <span class="nx">desc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">copy</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">merge</span><span class="p">([]</span><span class="o">,</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">types</span><span class="p">))</span><span class="o">?</span> <span class="nx">types</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">types</span> <span class="p">]);</span>
        <span class="nx">desc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">desc</span><span class="p">)</span><span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="o">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">copy</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">copy</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">copy</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">copy</span><span class="p">[</span><span class="nx">y</span><span class="p">]);</span>                
                <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">subsumes</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span>
                    <span class="nx">idx</span> <span class="o">=</span> <span class="nx">y</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="nx">copy</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">desc</span><span class="p">)</span> 
            <span class="nx">copy</span><span class="p">.</span><span class="nx">reverse</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">copy</span><span class="o">;</span>
    <span class="p">};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>File:   Attribute.js <br />
Author: <a href="http://github.com/neogermi/">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Adding capability of handling attribute structure and inheritance to VIE. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="s2">&quot;ERROR: VIE.Attribute is already defined. Please check your installation!&quot;</span><span class="o">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Attributes</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="s2">&quot;ERROR: VIE.Attributes is already defined. Please check your installation!&quot;</span><span class="o">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>The constructor of a VIE.Attribute. 
Usage: <code>var knowsAttr = new vie.Attribute("knows", ["Person"]);</code>
This creates a attribute that describes a <strong>knows</strong> relationship between persons.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Attribute</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">range</span><span class="o">,</span> <span class="nx">domain</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The attribute constructor needs an &#39;id&#39; of type string! E.g., &#39;Person&#39;&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">range</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The attribute constructor needs &#39;range&#39;.&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">domain</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The attribute constructor needs a &#39;domain&#39;.&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_domain</span> <span class="o">=</span> <span class="nx">domain</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">range</span> <span class="o">=</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">range</span><span class="p">))</span><span class="o">?</span> <span class="nx">range</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">range</span> <span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>TODO! this.count = {};</p>             </td>             <td class="code">               <div class="highlight"><pre>   
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">isUri</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">?</span> <span class="nx">id</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">uri</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>checks, whether the current attribute applies in the given range.
If range is a string, this does simply string comparison, if it
is a VIE.Type or an ID of a VIE.Type, then inheritance is checked as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">applies</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">range</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">range</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">r</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">r</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">range</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">range</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">r</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">isof</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">r</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="p">};</span>
            
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>basically a convenience class that represents a list of <code>VIE.Attribute</code>s.
As attributes are part of a certain <code>VIE.Type</code>, it needs to be passed on
for inheritance checks:
var attrs = new vie.Attributes(vie.types.get("Thing"), []);</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Attributes</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">domain</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">domain</span> <span class="o">=</span> <span class="nx">domain</span><span class="o">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_local</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_attributes</span> <span class="o">=</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>add a <code>VIE.Attribute</code> to the attributes.
Either pass a full <code>VIE.Attribute</code> object or
an id/range pair which then gets transformed into
a VIE.Attribute element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Attribute &#39;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; already registered for domain &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">domain</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="o">;</span>
        <span class="p">}</span> 
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">range</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">domain</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_local</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="o">;</span>
                <span class="k">return</span> <span class="nx">a</span><span class="o">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">id</span><span class="p">.</span><span class="nx">domain</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">domain</span><span class="o">;</span>
                <span class="nx">id</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="o">;</span>
            	<span class="k">this</span><span class="p">.</span><span class="nx">_local</span><span class="p">[</span><span class="nx">id</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="o">;</span>
                <span class="k">return</span> <span class="nx">id</span><span class="o">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="s2">&quot;Wrong argument to VIE.Types.add()!&quot;</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>removes a <code>VIE.Attribute</code> from the attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_local</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_local</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
            <span class="k">return</span> <span class="nx">a</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="s2">&quot;The attribute &quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; is inherited and cannot be removed from the domain &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">domain</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>retrieve a <code>VIE.Attribute</code> from the attributes by it's id.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">lid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">isUri</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">?</span> <span class="nx">id</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">uri</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inherit</span><span class="p">().</span><span class="nx">_attributes</span><span class="p">[</span><span class="nx">lid</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Wrong argument in VIE.Attributes.get()&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>creates a full list of all attributes (local and inherited).
the ranges of inherited attributes with the same id will be merged. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">_inherit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="p">{}</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_local</span><span class="p">);</span>
        
        <span class="kd">var</span> <span class="nx">inherited</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">domain</span><span class="p">.</span><span class="nx">supertypes</span><span class="p">.</span><span class="nx">list</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
               <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">attributes</span><span class="o">;</span> 
            <span class="p">});</span>
        
        <span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="kd">var</span> <span class="nx">merge</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">inherited</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">a</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">inherited</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">list</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">x</span><span class="p">].</span><span class="nx">id</span><span class="o">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">attributes</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">add</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">merge</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">add</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">x</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">,</span> <span class="nx">add</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">range</span><span class="p">);</span>
                            <span class="nx">delete</span> <span class="nx">add</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
                        <span class="p">}</span>
                        <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">x</span><span class="p">].</span><span class="nx">range</span><span class="p">);</span>
                        <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">unduplicate</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>add</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">attributes</span><span class="o">,</span> <span class="nx">add</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>merge</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">merged</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">r</span> <span class="o">&lt;</span> <span class="nx">merged</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">merged</span><span class="p">[</span><span class="nx">r</span><span class="p">]);</span>
                <span class="kd">var</span> <span class="nx">isAncestorOf</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">merged</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">continue</span><span class="o">;</span>
                        <span class="p">}</span>
                        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">merged</span><span class="p">[</span><span class="nx">x</span><span class="p">]);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">isof</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">isAncestorOf</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAncestorOf</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ranges</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">merged</span><span class="p">[</span><span class="nx">r</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">attributes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">ranges</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_attributes</span> <span class="o">=</span> <span class="nx">attributes</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>returns an Array of all attributes, combined
with the inherited ones.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">toArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inherit</span><span class="p">().</span><span class="nx">_attributes</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">range</span> <span class="o">||</span> <span class="nx">attributes</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">applies</span><span class="p">(</span><span class="nx">range</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">a</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
    <span class="p">};</span>
        
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">attrs</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">attrs</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">attrs</span> <span class="p">];</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">a</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">range</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>File:   Namespace.js <br />
Author: <a href="http://github.com/neogermi/">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Adding capability of handling different namespaces to VIE. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Namespaces</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="s2">&quot;ERROR: VIE.Namespaces is already defined. Please check your installation!&quot;</span><span class="o">;</span>
<span class="p">}</span>

 </pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Usage: <code>var namespaces = new VIE.Namespaces("http://base.namespace.com/");</code>
We can also bootstrap namespaces by passing an object:
``var namespaces = new vie.Namespaces("http://base.namespace.com/", {"foaf": "http://xmlns.com/foaf/0.1/"});</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">Namespaces</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">base</span><span class="o">,</span> <span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Within VIE, we can define a base namespace, to support easier syntax for
querying types of entities.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;Please provide a base namespace!&quot;</span><span class="o">;</span>
    <span class="p">}</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">base</span><span class="o">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ns</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>getter</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ns</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_base</span><span class="o">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>setter</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ns</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_base</span> <span class="o">=</span> <span class="nx">ns</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Please provide a valid namespace!&quot;</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span> <span class="o">=</span> <span class="p">(</span><span class="nx">namespaces</span><span class="p">)</span><span class="o">?</span> <span class="nx">namespaces</span> <span class="o">:</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Add new namespacs. This also checks if there are
prefixes or namespaces already defined to avoid
ambiguities in the namespaces. Use <code>addOrReplace()</code>
to simply overwrite them. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>we can also pass multiple namespaces as an object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">k</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k1</span> <span class="k">in</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">k1</span><span class="o">,</span> <span class="nx">k</span><span class="p">[</span><span class="nx">k1</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>use <code>add("", "http://new.base.namespace/");</code> to set
a new base namespace. This is the same as 
<code>base("http://new.base.namespace/");</code></p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>check if we overwrite existing mappings</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">containsPrefix</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;ERROR: Trying to register namespace prefix mapping (&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">+</span> <span class="s2">&quot;)!&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;There is already a mapping existing: &#39;(&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&#39;!&quot;</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k1</span><span class="o">,</span><span class="nx">v1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">v1</span> <span class="o">===</span> <span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">k1</span> <span class="o">!==</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="s2">&quot;ERROR: Trying to register namespace prefix mapping (&quot;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">+</span> <span class="s2">&quot;)!&quot;</span> <span class="o">+</span>
                          <span class="s2">&quot;There is already a mapping existing: &#39;(&quot;</span> <span class="o">+</span> <span class="nx">k1</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">+</span> <span class="s2">&quot;)&#39;!&quot;</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="o">;</span>
        
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>this has the same capabilities as <code>add(k, v);</code> but
overwrites already exising mappings.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">addOrReplace</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">k</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k1</span> <span class="k">in</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addOrReplace</span><span class="p">(</span><span class="nx">k1</span><span class="o">,</span> <span class="nx">k</span><span class="p">[</span><span class="nx">k1</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>check if we overwrite existing mappings</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">containsPrefix</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k1</span><span class="o">,</span><span class="nx">v1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">v1</span> <span class="o">===</span> <span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">k1</span> <span class="o">!==</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">k1</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>get a namespace (or <em>undefined</em>) for a given prefix.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>get a prefix (or <em>undefined</em>) for a given namespace.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">getPrefix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k1</span><span class="o">,</span><span class="nx">v1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">v1</span> <span class="o">===</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">k1</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>check if a prefix exists. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">containsPrefix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>check if a namespace exists. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">containsNamespace</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPrefix</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="o">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>update the prefix <em>p</em> with the namespace <em>n</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="o">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">n</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>remove the namespace with the prefix <em>p</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>return a copy of the internal structure of the namespaces
as key/value pairs.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">toObj</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_base</span><span class="p">}</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_namespaces</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>transform a URI into a CURIE with the given
namespaces. If <em>safe</em> is true, this returns
a SCURIE. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">curie</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">safe</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">toCurie</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">safe</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>checks whether the given string is a CURIE.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">isCurie</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">something</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">return</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">something</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>transforms a CURIE into a URI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">uri</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">curie</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">toUri</span> <span class="p">(</span><span class="nx">curie</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>checks wether the given string is a URI.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">isUri</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isUri</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Classic VIE API bindings to new VIE</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicRDFa</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vie</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="nx">vie</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicRDFa</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">readEntities</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">jsonEntities</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">RDFaEntities</span><span class="p">.</span><span class="nx">getInstances</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">entities</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">jsonEntities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">toJSONLD</span><span class="p">());</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">jsonEntities</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicRDFaEntities</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vie</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="nx">vie</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicRDFaEntities</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getInstances</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">services</span><span class="p">.</span><span class="nx">rdfa</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">RdfaService</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">foundEntities</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">loaded</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span><span class="nx">element</span><span class="o">:</span> <span class="nx">selector</span><span class="p">}).</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;rdfa&#39;</span><span class="p">).</span><span class="nx">execute</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entities</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">foundEntities</span> <span class="o">=</span> <span class="nx">entities</span><span class="o">;</span>
            <span class="nx">loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">});</span>

        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">foundEntities</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">getInstance</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">instances</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getInstances</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">instances</span> <span class="o">&amp;&amp;</span> <span class="nx">instances</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicEntityManager</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vie</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="nx">vie</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">entities</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ClassicEntityManager</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getBySubject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">getByJSONLD</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">addOrUpdate</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">initializeCollection</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>File:   DBPediaService.js <br />
Author: <a href="http://github.com/neogermi/">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DBPediaService</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;dbpedia&#39;</span><span class="o">,</span>
        <span class="nx">namespaces</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">owl</span>    <span class="o">:</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#&quot;</span><span class="o">,</span>
            <span class="nx">yago</span>   <span class="o">:</span> <span class="s2">&quot;http://dbpedia.org/class/yago/&quot;</span><span class="o">,</span>
            <span class="nx">dbonto</span> <span class="o">:</span> <span class="s1">&#39;http://dbpedia.org/ontology/&#39;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaults</span><span class="o">,</span> <span class="nx">options</span> <span class="o">?</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c">// will be set via VIE.use();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DBPediaConnector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
        <span class="nx">converters</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;text application/rdf+json&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">s</span><span class="p">);}}</span>
    <span class="p">});</span>

<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DBPediaService</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>this means that the namespace is already in the VIE.namespace
ignore for now!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Namespaces</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">rules</span> <span class="o">=</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>rule to transform a DBPedia person into a VIE person</p>             </td>             <td class="code">               <div class="highlight"><pre>             <span class="p">{</span>
                <span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="p">[</span>
                    <span class="s1">&#39;?subject a &lt;http://dbpedia.org/ontology/Person&gt;&#39;</span><span class="o">,</span>
                 <span class="p">]</span><span class="o">,</span>
                 <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ns</span><span class="p">){</span>
                     <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
                         <span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span>
                         <span class="s1">&#39; a &lt;http://schema.org/Person&gt;&#39;</span><span class="o">,</span> <span class="p">{</span>
                             <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span>
                         <span class="p">});</span>
                     <span class="p">};</span>
                 <span class="p">}(</span><span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">())</span>
             <span class="p">}</span>
        <span class="p">];</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>VIE API load implementation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loadable</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">loadable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Loadable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&quot;Invalid Loadable passed&quot;</span><span class="o">;</span><span class="p">}</span>

        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">loadable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entity</span><span class="o">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">entity</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;DBPediaConnector: No entity to look for!&quot;</span><span class="p">);</span>
            <span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]);</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        	<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

        	<span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
    			<span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
        		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        			<span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{</span>
        		        <span class="s1">&#39;@subject&#39;</span><span class="o">:</span> <span class="nx">entity</span><span class="o">,</span>
        		        <span class="s1">&#39;@type&#39;</span><span class="o">:</span> <span class="nx">results</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&quot;</span><span class="p">]</span>
        			<span class="p">};</span>
        			<span class="nx">delete</span> <span class="nx">results</span><span class="p">[</span><span class="nx">id</span><span class="p">][</span><span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&quot;</span><span class="p">];</span>
        			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">results</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
        			<span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
        			<span class="nx">e</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
        		<span class="p">}</span>
        		<span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="nx">e</span><span class="p">]);</span>
        	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        		<span class="nx">loadable</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
        	<span class="p">}</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loadable</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">connector</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">DBPediaConnector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">DBPediaConnector</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">uri</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="o">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.jrdf&quot;</span><span class="o">;</span>

        <span class="kd">var</span> <span class="nx">format</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">format</span> <span class="o">||</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="o">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">process</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>We're on Node.js, don't use jQuery.ajax</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadNode</span><span class="p">(</span><span class="nx">url</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="o">,</span> <span class="nx">format</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span><span class="o">,</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span><span class="o">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="o">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="o">,</span>
            <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;jsonp&quot;</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">loadNode</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="o">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">request</span><span class="p">({</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="o">,</span>
            <span class="nx">uri</span><span class="o">:</span> <span class="nx">uri</span><span class="o">,</span>
            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">Accept</span><span class="o">:</span> <span class="nx">format</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="o">,</span> <span class="nx">response</span><span class="o">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">success</span><span class="p">({</span><span class="nx">results</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">)});</span>
        <span class="p">});</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="p">})();</span>

<span class="c">/* TODO: give same functionality as RdfaService or remove</span>

<span class="c">VIE.prototype.RdfaRdfQueryService = function(options) {</span>
<span class="c">    if (!options) {</span>
<span class="c">        options = {};</span>
<span class="c">    }</span>
<span class="c">    this.vie = null;</span>
<span class="c">    this.name = &#39;rdfa&#39;;</span>

<span class="c">    if (typeof jQuery.rdf !== &#39;function&#39;) {</span>
<span class="c">        throw &quot;RdfQuery is not loaded&quot;;</span>
<span class="c">    }</span>
<span class="c">};</span>

<span class="c">VIE.prototype.RdfaRdfQueryService.prototype = {</span>

<span class="c">    load: function(loadable){</span>
<span class="c">        var service = this;</span>
<span class="c">        var correct = loadable instanceof this.vie.Loadable;</span>
<span class="c">        if (!correct) {</span>
<span class="c">            throw &quot;Invalid Loadable passed&quot;;</span>
<span class="c">        }</span>
<span class="c">        </span>
<span class="c">        var element = loadable.options.element ? loadable.options.element : jQuery(document);</span>
<span class="c">        </span>
<span class="c">        var rdf = jQuery(element).rdfa();</span>
<span class="c">        </span>
<span class="c">        jQuery.each(jQuery(element).xmlns(), function(prefix, ns){</span>
<span class="c">            service.vie.namespaces.addOrReplace(prefix, ns.toString());</span>
<span class="c">        });</span>
<span class="c">        </span>
<span class="c">        var entities = {}</span>
<span class="c">        rdf.where(&#39;?subject ?property ?object&#39;).each(function(){</span>
<span class="c">            var subject = this.subject.toString();</span>
<span class="c">            if (!entities[subject]) {</span>
<span class="c">                entities[subject] = {</span>
<span class="c">                    &#39;@subject&#39;: subject</span>
<span class="c">                };</span>
<span class="c">            }</span>
<span class="c">            var propertyUri = this.property.toString();</span>
<span class="c">            </span>
<span class="c">            var val;</span>
<span class="c">            if (typeof this.object.value === &quot;string&quot;) {</span>
<span class="c">                val = this.object.value;</span>
<span class="c">            }</span>
<span class="c">            else {</span>
<span class="c">                val = this.object.toString();</span>
<span class="c">            }</span>
<span class="c">            if (!entities[subject][propertyUri]) {</span>
<span class="c">                entities[subject][propertyUri] = val;</span>
<span class="c">            }</span>
<span class="c">            else </span>
<span class="c">                if (!_.isArray(entities[subject][propertyUri])) {</span>
<span class="c">                    entities[subject][propertyUri] = [entities[subject][propertyUri]];</span>
<span class="c">                    entities[subject][propertyUri].push(val);</span>
<span class="c">                }</span>
<span class="c">                else {</span>
<span class="c">                    entities[subject][propertyUri].push(val);</span>
<span class="c">                }</span>
<span class="c">        });</span>
<span class="c">        </span>
<span class="c">        var vieEntities = [];</span>
<span class="c">        jQuery.each(entities, function(){</span>
<span class="c">            vieEntities.push(service.vie.entities.addOrUpdate(this));</span>
<span class="c">        });</span>
<span class="c">        loadable.resolve(vieEntities);</span>
<span class="c">    }</span>
<span class="c">};</span>


<span class="c">*/</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RdfaService</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;rdfa&#39;</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">subjectSelector</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">subjectSelector</span> <span class="o">:</span> <span class="s2">&quot;[about],[typeof],[src],[href],html&quot;</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">predicateSelector</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">predicateSelector</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">predicateSelector</span> <span class="o">:</span> <span class="s2">&quot;[property],[rel]&quot;</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">views</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">RdfaService</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    
    <span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">analyzable</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>in a certain way, analyze is the same as load</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>

        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">analyzable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Analyzable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&quot;Invalid Analyzable passed&quot;</span><span class="o">;</span><span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Loadable</span><span class="p">({</span><span class="nx">element</span> <span class="o">:</span> <span class="nx">analyzable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span><span class="p">}));</span>
    <span class="p">}</span><span class="o">,</span>
        
    <span class="nx">load</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loadable</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">loadable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Loadable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Invalid Loadable passed&quot;</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">element</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loadable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> 
                <span class="k">return</span> <span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]);</span>
            <span class="p">}</span>
            <span class="nx">element</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">element</span> <span class="o">=</span> <span class="nx">loadable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">xmlns</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prefix</span> <span class="k">in</span> <span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">addOrReplace</span><span class="p">(</span><span class="nx">prefix</span><span class="o">,</span> <span class="nx">ns</span><span class="p">[</span><span class="nx">prefix</span><span class="p">]);</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="o">,</span> <span class="nx">element</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="p">)).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">_readEntity</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">entities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">entities</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">save</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">savable</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">savable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Savable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Invalid Savable passed&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">savable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>FIXME: we could find element based on subject</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">throw</span> <span class="s2">&quot;Unable to write entity to RDFa, no element given&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">savable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Unable to write to RDFa, no entity given&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="k">this</span><span class="p">.</span><span class="nx">_writeEntity</span><span class="p">(</span><span class="nx">savable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">savable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
        <span class="nx">savable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_readEntity</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getElementType</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">predicate</span><span class="o">,</span> <span class="nx">value</span><span class="o">,</span> <span class="nx">valueCollection</span><span class="o">;</span>
        
        <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readEntityPredicates</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>if (jQuery.isEmptyObject(entity)) {
   return null;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">predicate</span> <span class="k">in</span> <span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">];</span> 
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s2">&quot;object&quot;</span> <span class="o">||</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;[object Array]&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="nx">valueCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Collection</span><span class="p">();</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valueItem</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">valueCollection</span><span class="p">.</span><span class="nx">addOrUpdate</span><span class="p">({</span><span class="s1">&#39;@subject&#39;</span><span class="o">:</span> <span class="nx">valueItem</span><span class="p">});</span>
            <span class="p">});</span>
            <span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">valueCollection</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="nx">entity</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">subject</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        	<span class="nx">entity</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="o">;</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">entityInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Entity</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
        <span class="nx">entityInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">addOrUpdate</span><span class="p">(</span><span class="nx">entityInstance</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_registerEntityView</span><span class="p">(</span><span class="nx">entityInstance</span><span class="o">,</span> <span class="nx">element</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">entityInstance</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_writeEntity</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_findPredicateElements</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">predicateElement</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">predicate</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getElementPredicate</span><span class="p">(</span><span class="nx">predicateElement</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entity</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">predicate</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
    
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">predicate</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">service</span><span class="p">.</span><span class="nx">readElementValue</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">predicateElement</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
    
            <span class="nx">service</span><span class="p">.</span><span class="nx">writeElementValue</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">predicateElement</span><span class="o">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_getViewForElement</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="o">,</span> <span class="nx">collectionView</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">viewInstance</span><span class="o">;</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">views</span><span class="o">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">collectionView</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="p">}</span>
                <span class="nx">viewInstance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">viewInstance</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_registerEntityView</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">viewInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getViewForElement</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">viewInstance</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">viewInstance</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="nx">viewInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Entity</span><span class="p">({</span>
            <span class="nx">model</span><span class="o">:</span> <span class="nx">entity</span><span class="o">,</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">element</span><span class="o">,</span>
            <span class="nx">tagName</span><span class="o">:</span> <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span><span class="o">,</span>
            <span class="nx">vie</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="o">,</span>
            <span class="nx">service</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">viewInstance</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Find collection elements and create collection views for them</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">attributes</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">predicate</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">attributeValue</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">fromReference</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">predicate</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attributeValue</span> <span class="k">instanceof</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Collection</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementByPredicate</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span><span class="o">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">service</span><span class="p">.</span><span class="nx">_registerCollectionView</span><span class="p">(</span><span class="nx">attributeValue</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">viewInstance</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_registerCollectionView</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">viewInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getViewForElement</span><span class="p">(</span><span class="nx">element</span><span class="o">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">viewInstance</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">viewInstance</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="kd">var</span> <span class="nx">entityTemplate</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;:first-child&#39;</span><span class="p">);</span>
    
        <span class="nx">viewInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Collection</span><span class="p">({</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">collection</span><span class="o">,</span>
            <span class="nx">model</span><span class="o">:</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">model</span><span class="o">,</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">element</span><span class="o">,</span>
            <span class="nx">template</span><span class="o">:</span> <span class="nx">entityTemplate</span><span class="o">,</span>
            <span class="nx">service</span><span class="o">:</span> <span class="k">this</span><span class="o">,</span>
            <span class="nx">tagName</span><span class="o">:</span> <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">viewInstance</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">viewInstance</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_getElementType</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    	<span class="kd">var</span> <span class="nx">type</span><span class="o">;</span>
     	<span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;typeof&#39;</span><span class="p">))</span> <span class="p">{</span>
	     	<span class="nx">type</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;typeof&#39;</span><span class="p">);</span>
		     	<span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;://&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		     	<span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
	     	<span class="p">}</span>
	     	<span class="k">else</span> <span class="p">{</span>
		     	<span class="k">return</span> <span class="nx">type</span><span class="o">;</span>
	     	<span class="p">}</span>
     	<span class="p">}</span>
     	<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
     <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">getElementSubject</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span> <span class="o">===</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">baseURI</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">subject</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">subject</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;typeof&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">subject</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">blankNodeID</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>subject = this;</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>We also handle baseURL outside browser context by manually
looking for the <code>&lt;base&gt;</code> element inside HTML head.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">nodeName</span> <span class="o">===</span> <span class="s1">&#39;HTML&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">subject</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">});</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">undefined</span><span class="o">;</span>
        <span class="p">}</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">subject</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">subject</span><span class="o">;</span>
        <span class="p">}</span>
    
        <span class="k">return</span> <span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;_:&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span><span class="o">?</span> <span class="nx">subject</span> <span class="o">:</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">subject</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">setElementSubject</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="o">,</span> <span class="nx">subject</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="o">,</span> <span class="nx">subject</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">getElementPredicate</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">predicate</span><span class="o">;</span>
        <span class="nx">predicate</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">predicate</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">predicate</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">predicate</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">getElementBySubject</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="o">!==</span> <span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
     
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">getElementByPredicate</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">predicateSelector</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">predicateSelector</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">foundPredicate</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getElementPredicate</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">curie</span><span class="p">(</span><span class="nx">foundPredicate</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">curie</span><span class="p">(</span><span class="nx">predicate</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">))</span> <span class="o">!==</span> <span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
     
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_readEntityPredicates</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="nx">emptyValues</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">entityPredicates</span> <span class="o">=</span> <span class="p">{};</span>
    
        <span class="k">this</span><span class="p">.</span><span class="nx">_findPredicateElements</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">predicateElement</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">predicate</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getElementPredicate</span><span class="p">(</span><span class="nx">predicateElement</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">readElementValue</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">predicateElement</span><span class="p">);</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">emptyValues</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="p">}</span>
   
            <span class="nx">entityPredicates</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">});</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">tagName</span> <span class="o">!==</span> <span class="s1">&#39;HTML&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">parent</span><span class="p">(</span><span class="s1">&#39;[rev]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">entityPredicates</span><span class="p">[</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rev&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> 
            <span class="p">});</span>
        <span class="p">}</span>
    
        <span class="k">return</span> <span class="nx">entityPredicates</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_findPredicateElements</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="nx">allowNestedPredicates</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">predicateSelector</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">predicateSelector</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">allowNestedPredicates</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s1">&#39;[property]&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
    
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">readElementValue</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>The <code>content</code> attribute can be used for providing machine-readable
values for elements where the HTML presentation differs from the
actual value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">content</span><span class="o">;</span>
        <span class="p">}</span>
                </pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>The <code>resource</code> attribute can be used to link a predicate to another
RDF resource.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">resource</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
        <span class="p">}</span>
                </pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p><code>href</code> attribute also links to another RDF resource.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">href</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">predicate</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">href</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">;</span>
        <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>If the predicate is a relation, we look for identified child objects
and provide their identifiers as the values. To protect from scope
creep, we only support direct descentants of the element where the
<code>rel</code> attribute was set.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subjectSelector</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">value</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">value</span><span class="o">;</span>
        <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>If none of the checks above matched we return the HTML contents of
the element as the literal value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">html</span><span class="p">();</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">writeElementValue</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">predicate</span><span class="o">,</span> <span class="nx">element</span><span class="o">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>TODO: this is a hack, please fix!</p>             </td>             <td class="code">               <div class="highlight"><pre>     	<span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        </pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>The <code>content</code> attribute can be used for providing machine-readable
values for elements where the HTML presentation differs from the
actual value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="o">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="p">}</span>
                </pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>The <code>resource</code> attribute can be used to link a predicate to another
RDF resource.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="o">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Property has inline value. Change the HTML contents of the property
element to match the new value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">element</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    </pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>mostyl copied from http://code.google.com/p/rdfquery/source/browse/trunk/jquery.xmlns.js</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">xmlns</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$elem</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> 
                <span class="k">return</span> <span class="p">{};</span>
            <span class="p">}</span>
            <span class="nx">$elem</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$elem</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="nx">$elem</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">getNamedItemNS</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="sr">/^xmlns(:(.+))?$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">prefix</span> <span class="o">=</span> <span class="sr">/^xmlns(:(.+))?$/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
                        <span class="nx">value</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">nodeValue</span><span class="o">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">obj</span><span class="p">[</span><span class="nx">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">nodeValue</span><span class="o">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
        
        <span class="k">return</span> <span class="nx">obj</span><span class="o">;</span>
    <span class="p">}</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>File:   StanbolService.js
Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a>
Author: <a href="mailto:szaby.gruenwald@salzburgresearch.at">Szaby Gruenwald</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">StanbolService</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;stanbol&#39;</span><span class="o">,</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://dev.iks-project.eu:8080/&#39;</span><span class="o">,</span>
        <span class="nx">defaultProxyUrl</span> <span class="o">:</span> <span class="s2">&quot;../utils/proxy/proxy.php&quot;</span><span class="o">,</span>
        <span class="nx">namespaces</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">semdeski</span> <span class="o">:</span> <span class="s2">&quot;http://www.semanticdesktop.org/ontologies/2007/01/19/nie#&quot;</span><span class="o">,</span>
            <span class="nx">semdeskf</span> <span class="o">:</span> <span class="s2">&quot;http://www.semanticdesktop.org/ontologies/2007/03/22/nfo#&quot;</span><span class="o">,</span>
            <span class="nx">skos</span><span class="o">:</span> <span class="s2">&quot;http://www.w3.org/2004/02/skos/core#&quot;</span><span class="o">,</span>
            <span class="nx">foaf</span><span class="o">:</span> <span class="s2">&quot;http://xmlns.com/foaf/0.1/&quot;</span><span class="o">,</span>
            <span class="nx">opengis</span><span class="o">:</span> <span class="s2">&quot;http://www.opengis.net/gml/&quot;</span><span class="o">,</span>
            <span class="nx">dbpedia</span><span class="o">:</span> <span class="s2">&quot;http://dbpedia.org/ontology/&quot;</span><span class="o">,</span>
            <span class="nx">owl</span> <span class="o">:</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#&quot;</span><span class="o">,</span>
            <span class="nx">geonames</span> <span class="o">:</span> <span class="s2">&quot;http://www.geonames.org/ontology#&quot;</span><span class="o">,</span>
            <span class="nx">enhancer</span> <span class="o">:</span> <span class="s2">&quot;http://fise.iks-project.eu/ontology/&quot;</span><span class="o">,</span>
            <span class="nx">entityhub</span><span class="o">:</span> <span class="s2">&quot;http://www.iks-project.eu/ontology/rick/model/&quot;</span><span class="o">,</span>
            <span class="nx">entityhub2</span><span class="o">:</span> <span class="s2">&quot;http://www.iks-project.eu/ontology/rick/query/&quot;</span><span class="o">,</span>
            <span class="nx">rdfs</span><span class="o">:</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class="o">,</span>
            <span class="nx">dc</span>  <span class="o">:</span> <span class="s1">&#39;http://purl.org/dc/terms/&#39;</span><span class="o">,</span>
            <span class="nx">foaf</span><span class="o">:</span> <span class="s1">&#39;http://xmlns.com/foaf/0.1/&#39;</span><span class="o">,</span>
            <span class="nx">schema</span><span class="o">:</span> <span class="s1">&#39;http://schema.org/&#39;</span><span class="o">,</span>
            <span class="nx">rdfschema</span><span class="o">:</span> <span class="s1">&#39;http://www.w3.org/2000/01/rdf-schema#&#39;</span><span class="o">,</span>
            <span class="nx">geo</span><span class="o">:</span> <span class="s1">&#39;http://www.w3.org/2003/01/geo/wgs84_pos#&#39;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="nx">defaults</span><span class="o">,</span> <span class="nx">options</span> <span class="o">?</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c">// will be set via VIE.use();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StanbolConnector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
    
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
        <span class="nx">converters</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;text application/rdf+json&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">s</span><span class="p">);}}</span>
    <span class="p">});</span>

<span class="p">};</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">StanbolService</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>this means that the namespace is already in the VIE.namespace
ignore for now!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Namespaces</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">);</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">rules</span> <span class="o">=</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>rule to add backwards-relations to the triples
this makes querying for entities a lot easier!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">{</span><span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="p">[</span>
                <span class="s1">&#39;?subject a &lt;http://fise.iks-project.eu/ontology/EntityAnnotation&gt;&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?subject enhancer:entity-type ?type&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?subject enhancer:confidence ?confidence&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?subject enhancer:entity-reference ?entity&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?subject dc:relation ?relation&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?relation a &lt;http://fise.iks-project.eu/ontology/TextAnnotation&gt;&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?relation enhancer:selected-text ?selected-text&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?relation enhancer:selection-context ?selection-context&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?relation enhancer:start ?start&#39;</span><span class="o">,</span>
                <span class="s1">&#39;?relation enhancer:end ?end&#39;</span>
            <span class="p">]</span><span class="o">,</span>
             <span class="s1">&#39;right&#39;</span> <span class="o">:</span> <span class="p">[</span>
                 <span class="s1">&#39;?entity a ?type&#39;</span><span class="o">,</span>
                 <span class="s1">&#39;?entity enhancer:hasTextAnnotation ?relation&#39;</span><span class="o">,</span>
                 <span class="s1">&#39;?entity enhancer:hasEntityAnnotation ?subject&#39;</span>
             <span class="p">]</span>
             <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>rule(s) to transform a Stanbol person into a VIE person</p>             </td>             <td class="code">               <div class="highlight"><pre>             <span class="p">{</span>
                <span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="p">[</span>
                    <span class="s1">&#39;?subject a dbpedia:Person&#39;</span><span class="o">,</span>
                    <span class="s1">&#39;?subject rdfschema:label ?label&#39;</span>
                 <span class="p">]</span><span class="o">,</span>
                 <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ns</span><span class="p">){</span>
                     <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
                         <span class="k">return</span> <span class="p">[</span>
                             <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                                 <span class="s1">&#39;a&#39;</span><span class="o">,</span>
                                 <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;Person&gt;&#39;</span><span class="o">,</span> <span class="p">{</span>
                                     <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                                 <span class="p">})</span><span class="o">,</span>
                             <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                                 <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;name&gt;&#39;</span><span class="o">,</span>
                                 <span class="k">this</span><span class="p">.</span><span class="kd">label</span><span class="o">,</span> <span class="p">{</span>
                                     <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                                 <span class="p">})</span>
                             <span class="p">];</span>
                     <span class="p">};</span>
                 <span class="p">}(</span><span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span>
             <span class="p">}</span><span class="o">,</span>
             <span class="p">{</span>
             <span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="p">[</span>
                     <span class="s1">&#39;?subject a foaf:Person&#39;</span><span class="o">,</span>
                     <span class="s1">&#39;?subject rdfschema:label ?label&#39;</span>
                  <span class="p">]</span><span class="o">,</span>
                  <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ns</span><span class="p">){</span>
                      <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
                          <span class="k">return</span> <span class="p">[</span>
                              <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                                  <span class="s1">&#39;a&#39;</span><span class="o">,</span>
                                  <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;Person&gt;&#39;</span><span class="o">,</span> <span class="p">{</span>
                                      <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                                  <span class="p">})</span><span class="o">,</span>
                              <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                                  <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;name&gt;&#39;</span><span class="o">,</span>
                                  <span class="k">this</span><span class="p">.</span><span class="kd">label</span><span class="o">,</span> <span class="p">{</span>
                                      <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                                  <span class="p">})</span>
                              <span class="p">];</span>
                      <span class="p">};</span>
                  <span class="p">}(</span><span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span>
              <span class="p">}</span><span class="o">,</span>
             <span class="p">{</span>
                 <span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="p">[</span>
                     <span class="s1">&#39;?subject a dbpedia:Place&#39;</span><span class="o">,</span>
                     <span class="s1">&#39;?subject rdfschema:label ?label&#39;</span>
                  <span class="p">]</span><span class="o">,</span>
                  <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
                      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                          <span class="k">return</span> <span class="p">[</span>
                          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                              <span class="s1">&#39;a&#39;</span><span class="o">,</span>
                              <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;Place&gt;&#39;</span><span class="o">,</span> <span class="p">{</span>
                                  <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                              <span class="p">})</span><span class="o">,</span>
                          <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span>
                                  <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">base</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;name&gt;&#39;</span><span class="o">,</span>
                              <span class="k">this</span><span class="p">.</span><span class="kd">label</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="p">{</span>
                                  <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span>
                              <span class="p">})</span>
                          <span class="p">];</span>
                      <span class="p">};</span>
                  <span class="p">}(</span><span class="k">this</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span>
              <span class="p">}</span><span class="o">,</span>
        <span class="p">];</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">addOrOverwrite</span><span class="p">(</span><span class="s1">&#39;enhancer:EntityAnnotation&#39;</span><span class="o">,</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>TODO: add attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">]).</span><span class="nx">inherit</span><span class="p">(</span><span class="s2">&quot;Thing&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">addOrOverwrite</span><span class="p">(</span><span class="s1">&#39;enhancer:TextAnnotation&#39;</span><span class="o">,</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>TODO: add attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">]).</span><span class="nx">inherit</span><span class="p">(</span><span class="s2">&quot;Thing&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">addOrOverwrite</span><span class="p">(</span><span class="s1">&#39;enhancer:Enhancement&#39;</span><span class="o">,</span> <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>TODO: add attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">]).</span><span class="nx">inherit</span><span class="p">(</span><span class="s2">&quot;Thing&quot;</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>VIE API analyze implementation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">analyzable</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>

        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">analyzable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Analyzable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&quot;Invalid Analyzable passed&quot;</span><span class="o">;</span><span class="p">}</span>

        <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">analyzable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span> <span class="o">?</span> <span class="nx">analyzable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">element</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">_extractText</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>query enhancer with extracted text</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">_enhancer2Entities</span><span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">results</span><span class="p">);</span>
                <span class="nx">analyzable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">entities</span><span class="p">);</span>
            <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">analyzable</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">connector</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(</span><span class="nx">text</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="p">);</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;No text found in element.&quot;</span><span class="p">);</span>
            <span class="nx">analyzable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]);</span>
        <span class="p">}</span>

    <span class="p">}</span><span class="o">,</span>
    </pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>VIE API load implementation
Runs a Stanbol entityhub find</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">find</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">findable</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">findable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Findable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&quot;Invalid Findable passed&quot;</span><span class="o">;</span><span class="p">}</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>The term to find, * as wildcard allowed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">term</span> <span class="o">=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">findable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">term</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">term</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;StanbolConnector: No term to look for!&quot;</span><span class="p">);</span>
            <span class="nx">findable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]);</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">findable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">20</span> <span class="o">:</span> <span class="nx">findable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">limit</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">findable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">offset</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">findable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">offset</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>TODO: Return an array of vie entities</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">resultArray</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="o">,</span><span class="nx">k</span><span class="p">){</span>
                    <span class="nx">v</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">k</span><span class="o">;</span>
                    <span class="k">return</span> <span class="nx">v</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">);</span>
            <span class="nx">findable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">resultArray</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">findable</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">connector</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">term</span><span class="o">,</span> <span class="nx">limit</span><span class="o">,</span> <span class="nx">offset</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    </pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>VIE API load implementation
Runs a Stanbol entityhub find</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loadable</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">correct</span> <span class="o">=</span> <span class="nx">loadable</span> <span class="k">instanceof</span> <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Loadable</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">correct</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&quot;Invalid Loadable passed&quot;</span><span class="o">;</span><span class="p">}</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        
        <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">loadable</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entity</span><span class="o">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">entity</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;StanbolConnector: No entity to look for!&quot;</span><span class="p">);</span>
            <span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]);</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">_enhancer2Entities</span><span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">results</span><span class="p">);</span>
            <span class="nx">loadable</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">entities</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loadable</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">connector</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_extractText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
            <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> 
            <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s1">&#39;TEXTAREA&#39;</span> <span class="o">||</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s1">&#39;INPUT&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="o">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">element</span>
                <span class="p">.</span><span class="nx">text</span><span class="p">()</span>    <span class="c">//get the text of element</span>
                <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="o">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="c">//collapse multiple whitespaces</span>
                <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\0\b\n\r\f\t/g</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span> <span class="c">// remove non-letter symbols</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">_enhancer2Entities</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>transform data from Stanbol into VIE.Entities</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span> <span class="o">!==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enhancer2EntitiesNoRdfQuery</span><span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">results</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">rdf</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">().</span><span class="nx">load</span><span class="p">(</span><span class="nx">results</span><span class="o">,</span> <span class="p">{});</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>execute rules here!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">rules</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rules</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">ruleset</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prefix</span> <span class="k">in</span> <span class="nx">service</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
                	<span class="nx">rules</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">prefix</span><span class="o">,</span> <span class="nx">service</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">prefix</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">service</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">rules</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">rules</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">,</span> <span class="nx">service</span><span class="p">.</span><span class="nx">rules</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;right&#39;</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="nx">rdf</span> <span class="o">=</span> <span class="nx">rdf</span><span class="p">.</span><span class="nx">reason</span><span class="p">(</span><span class="nx">rules</span><span class="o">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c">// execute the rules only 10 times to avoid looping</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">rdf</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;?subject ?property ?object&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entities</span><span class="p">[</span><span class="nx">subject</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">entities</span><span class="p">[</span><span class="nx">subject</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;@subject&#39;</span><span class="o">:</span> <span class="nx">subject</span><span class="o">,</span>
                    <span class="s1">&#39;@context&#39;</span><span class="o">:</span> <span class="nx">service</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()</span><span class="o">,</span>
                    <span class="s1">&#39;@type&#39;</span><span class="o">:</span> <span class="p">[]</span>
                <span class="p">};</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">propertyUri</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">propertyCurie</span><span class="o">;</span>

            <span class="nx">propertyUri</span> <span class="o">=</span> <span class="nx">propertyUri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">propertyUri</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">property</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">propertyUri</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">service</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">()});</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">property</span> <span class="o">=</span> <span class="nx">propertyUri</span><span class="o">;</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">propertyUri</span> <span class="o">+</span> <span class="s2">&quot; doesn&#39;t have a namespace definition in &#39;&quot;</span><span class="o">,</span> <span class="nx">service</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">.</span><span class="nx">toObj</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="nx">entities</span><span class="p">[</span><span class="nx">subject</span><span class="p">][</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">[</span><span class="nx">subject</span><span class="p">][</span><span class="nx">property</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>

            <span class="kd">function</span> <span class="nx">getValue</span><span class="p">(</span><span class="nx">rdfQueryLiteral</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">){</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">lang</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                    <span class="k">else</span> 
                        <span class="k">return</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">value</span><span class="o">;</span>
                    <span class="k">return</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;uri&quot;</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">rdfQueryLiteral</span><span class="p">.</span><span class="nx">value</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">entities</span><span class="p">[</span><span class="nx">subject</span><span class="p">][</span><span class="nx">property</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">getValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">));</span>
        <span class="p">});</span>

        <span class="nx">_</span><span class="p">(</span><span class="nx">entities</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ent</span><span class="p">){</span>
            <span class="nx">ent</span><span class="p">[</span><span class="s2">&quot;@type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ent</span><span class="p">[</span><span class="s2">&quot;@type&quot;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">ent</span><span class="p">[</span><span class="s2">&quot;rdfs:type&quot;</span><span class="p">]);</span>
            <span class="nx">delete</span> <span class="nx">ent</span><span class="p">[</span><span class="s2">&quot;rdfs:type&quot;</span><span class="p">];</span>
            <span class="nx">_</span><span class="p">(</span><span class="nx">ent</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">property</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">){</span>
                    <span class="nx">ent</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>

        <span class="kd">var</span> <span class="nx">vieEntities</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">entities</span><span class="o">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entityInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">Entity</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="nx">entityInstance</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">addOrUpdate</span><span class="p">(</span><span class="nx">entityInstance</span><span class="p">);</span>
            <span class="nx">vieEntities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entityInstance</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">vieEntities</span><span class="o">;</span> 
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">_enhancer2EntitiesNoRdfQuery</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">service</span><span class="o">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsonLD</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">results</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">entity</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">entity</span><span class="p">[</span><span class="s1">&#39;@subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="nx">predicate</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">predicate</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">predicate</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">triple</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">triple</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;uri&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">triple</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">triple</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]];</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">triple</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                        <span class="k">return</span><span class="o">;</span>
                    <span class="p">}</span>
                    <span class="nx">entity</span><span class="p">[</span><span class="nx">predicate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">triple</span><span class="p">.</span><span class="nx">value</span><span class="o">;</span>
                <span class="p">});</span>
            <span class="p">});</span>
            <span class="nx">jsonLD</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">jsonLD</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">StanbolConnector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enhancerUrlPrefix</span> <span class="o">=</span> <span class="s2">&quot;/engines&quot;</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">entityhubUrlPrefix</span> <span class="o">=</span> <span class="s2">&quot;/entityhub&quot;</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>TODO: this.ontonetUrlPrefix = "/ontonet";
TODO: this.rulesUrlPrefix = "/rules";
TODO: this.factstoreUrlPrefix = "/factstore";</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">};</span>
<span class="nx">StanbolConnector</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    
    <span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">enhancerUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">enhancerUrlPrefix</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">proxyUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_proxyUrl</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">format</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">format</span> <span class="o">||</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="o">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">process</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>We're on Node.js, don't use jQuery.ajax</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">analyzeNode</span><span class="p">(</span><span class="nx">enhancerUrl</span><span class="o">,</span> <span class="nx">text</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="o">,</span> <span class="nx">format</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span><span class="o">,</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span><span class="o">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="o">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">||</span> <span class="nx">enhancerUrl</span><span class="o">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">(</span><span class="nx">proxyUrl</span><span class="p">)</span> <span class="o">?</span> <span class="p">{</span>
                    <span class="nx">proxy_url</span><span class="o">:</span> <span class="nx">enhancerUrl</span><span class="o">,</span> 
                    <span class="nx">content</span><span class="o">:</span> <span class="nx">text</span><span class="o">,</span>
                    <span class="nx">verb</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="o">,</span>
                    <span class="nx">format</span><span class="o">:</span> <span class="nx">format</span>
                <span class="p">}</span> <span class="o">:</span> <span class="nx">text</span><span class="o">,</span>
            <span class="nx">dataType</span><span class="o">:</span> <span class="nx">format</span><span class="o">,</span>
            <span class="nx">contentType</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="o">,</span>
            <span class="nx">accepts</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;application/rdf+json&quot;</span><span class="o">:</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="p">}</span>

        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">analyzeNode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="o">,</span> <span class="nx">text</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="o">,</span> <span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">request</span><span class="p">({</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="o">,</span>
            <span class="nx">uri</span><span class="o">:</span> <span class="nx">url</span><span class="o">,</span>
            <span class="nx">body</span><span class="o">:</span> <span class="nx">text</span><span class="o">,</span>
            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">Accept</span><span class="o">:</span> <span class="nx">format</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="o">,</span> <span class="nx">response</span><span class="o">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">success</span><span class="p">({</span><span class="nx">results</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">)});</span>
        <span class="p">});</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
        <span class="nx">uri</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">entityhubUrlPrefix</span> <span class="o">+</span> <span class="s2">&quot;/sites/entity?id=&quot;</span> <span class="o">+</span> <span class="nx">uri</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">proxyUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_proxyUrl</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">format</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">format</span> <span class="o">||</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="o">;</span>
        
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span><span class="o">,</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span><span class="o">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="p">(</span><span class="nx">proxyUrl</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;POST&quot;</span> <span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="o">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">||</span> <span class="nx">url</span><span class="o">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">(</span><span class="nx">proxyUrl</span><span class="p">)</span> <span class="o">?</span> <span class="p">{</span>
                    <span class="nx">proxy_url</span><span class="o">:</span> <span class="nx">url</span><span class="o">,</span> 
                    <span class="nx">content</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="o">,</span>
                    <span class="nx">verb</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="o">,</span>
                    <span class="nx">format</span><span class="o">:</span> <span class="nx">format</span>
                <span class="p">}</span> <span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
            <span class="nx">dataType</span><span class="o">:</span> <span class="nx">format</span><span class="o">,</span>
            <span class="nx">contentType</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="o">,</span>
            <span class="nx">accepts</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;application/rdf+json&quot;</span><span class="o">:</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">find</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">term</span><span class="o">,</span> <span class="nx">limit</span><span class="o">,</span> <span class="nx">offset</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>curl -X POST -d "name=Bishofsh&amp;limit=10&amp;offset=0" http://localhost:8080/entityhub/sites/find</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">limit</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">entityhubUrlPrefix</span> <span class="o">+</span> <span class="s2">&quot;/sites/find&quot;</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">proxyUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_proxyUrl</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">format</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">format</span> <span class="o">||</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="o">;</span>
        
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span><span class="o">,</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span><span class="o">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="o">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">||</span> <span class="nx">url</span><span class="o">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">(</span><span class="nx">proxyUrl</span><span class="p">)</span> <span class="o">?</span> <span class="p">{</span>
                    <span class="nx">proxy_url</span><span class="o">:</span> <span class="nx">url</span><span class="o">,</span> 
                    <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">name</span> <span class="o">:</span> <span class="nx">term</span><span class="o">,</span>
                        <span class="nx">limit</span> <span class="o">:</span> <span class="nx">limit</span><span class="o">,</span>
                        <span class="nx">offset</span><span class="o">:</span> <span class="nx">offset</span>
                    <span class="p">}</span><span class="o">,</span>
                    <span class="nx">verb</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="o">,</span>
                    <span class="nx">format</span><span class="o">:</span> <span class="nx">format</span><span class="o">,</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span>
                <span class="p">}</span> <span class="o">:</span> <span class="s2">&quot;name=&quot;</span> <span class="o">+</span> <span class="nx">term</span> <span class="o">+</span> <span class="s2">&quot;&amp;limit=&quot;</span> <span class="o">+</span> <span class="nx">limit</span> <span class="o">+</span> <span class="s2">&quot;&amp;offset=&quot;</span> <span class="o">+</span> <span class="nx">offset</span><span class="o">,</span>
            <span class="nx">dataType</span><span class="o">:</span> <span class="nx">format</span><span class="o">,</span>
            <span class="nx">contentType</span><span class="o">:</span> <span class="nx">proxyUrl</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="o">,</span>
            <span class="nx">accepts</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;application/rdf+json&quot;</span><span class="o">:</span> <span class="s2">&quot;application/rdf+json&quot;</span><span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_proxyUrl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">proxyUrl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">proxyDisabled</span><span class="p">){</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">proxyUrl</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">defaultProxyUrl</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="p">})();</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">}</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Ensure the collection view gets updated when items get added or removed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">template</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">service</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;No RDFa service provided to the Collection View&quot;</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="s1">&#39;addItem&#39;</span><span class="o">,</span> <span class="s1">&#39;removeItem&#39;</span><span class="o">,</span> <span class="s1">&#39;refreshItems&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">addItem</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Make the view aware of existing entities in collection</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">view</span><span class="p">.</span><span class="nx">registerItem</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">collection</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">addItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">collection</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">entityView</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">_registerEntityView</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">cloneElement</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">entityElement</span> <span class="o">=</span> <span class="nx">entityView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">setElementSubject</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">getSubjectUri</span><span class="p">()</span><span class="o">,</span> <span class="nx">entityElement</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>TODO: Ordering</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">entityElement</span><span class="p">);</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="o">,</span> <span class="nx">entityView</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span><span class="p">[</span><span class="nx">entity</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entityView</span><span class="o">;</span>
        <span class="nx">entityElement</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">registerItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementBySubject</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">entityView</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">_registerEntityView</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">element</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span><span class="p">[</span><span class="nx">entity</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entityView</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">removeItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span><span class="p">[</span><span class="nx">entity</span><span class="p">.</span><span class="nx">cid</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span><span class="p">[</span><span class="nx">entity</span><span class="p">.</span><span class="nx">cid</span><span class="p">].</span><span class="nx">el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="nx">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">entityViews</span><span class="p">[</span><span class="nx">entity</span><span class="p">.</span><span class="nx">cid</span><span class="p">]);</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">refreshItems</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
        <span class="nx">collection</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">view</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">entity</span><span class="o">,</span> <span class="nx">collection</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>

    <span class="nx">cloneElement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newElement</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">clone</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Direct match with container</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">newElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">newElement</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;[about]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">getElementSubject</span><span class="p">(</span><span class="nx">newElement</span><span class="p">);</span>
        <span class="nx">service</span><span class="p">.</span><span class="nx">_findPredicateElements</span><span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">newElement</span><span class="o">,</span> <span class="kc">false</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">service</span><span class="p">.</span><span class="nx">writeElementValue</span><span class="p">(</span><span class="kc">null</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">newElement</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">}</span>

<span class="nx">VIE</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">Entity</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">service</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">service</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">service</span> <span class="o">:</span> <span class="s1">&#39;rdfa&#39;</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">vie</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Ensure view gets updated when properties of the Entity change.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="s1">&#39;render&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Rendering a view means writing the properties of the Entity back to
the element containing our RDFa annotations.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vie</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
                <span class="nx">element</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="o">,</span> 
                <span class="nx">entity</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span>
            <span class="p">}).</span>
            <span class="nx">to</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">).</span>
            <span class="nx">execute</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">});</span> 

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 